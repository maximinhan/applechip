ext.buildTimestamp = new Date().format('yyyy-MM-dd HH:mm:ss S')
version = new ProjectVersion(version, System.env.SOURCE_BUILD_NUMBER)
class ProjectVersion {
	String version
	String build
	
	ProjectVersion(String version, String build) {
		this.version = version
		this.build = build
	}
	@Override
	String toString() {
		String version = version
		if(build) {
			version += ".$build"
		}
		version
	}
}

task createBuildInfoFile << {
	def buildInfoFile = new File("$buildDir/build-info.properties")
	Properties properties = new Properties()
	println version
	println System.env.SOURCE_BUILD_NUMBER
	println project.version.toString()
	println buildTimestamp
	properties.setProperty('version', project.version.toString())
	properties.setProperty('buildTimestamp', buildTimestamp)
	properties.store(buildInfoFile.newWriter(), null)
}